var B=Object.defineProperty,H=Object.defineProperties;var K=Object.getOwnPropertyDescriptors;var C=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable;var D=(e,t,s)=>t in e?B(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,b=(e,t)=>{for(var s in t||(t={}))Q.call(t,s)&&D(e,s,t[s]);if(C)for(var s of C(t))V.call(t,s)&&D(e,s,t[s]);return e},q=(e,t)=>H(e,K(t));import{a as $,k as A,c as Y,b as E,v as U,C as F,d as Z,e as ee,f as te,h as ne,t as se,R as oe,i as z,r as re,l as k,o as ie,s as ce}from"./index.1411fdd8.js";const I={102100:{maxX:20037508342788905e-9,minX:-20037508342788905e-9,plus180Line:new $({paths:[[[20037508342788905e-9,-20037508342788905e-9],[20037508342788905e-9,20037508342788905e-9]]],spatialReference:A.WebMercator}),minus180Line:new $({paths:[[[-20037508342788905e-9,-20037508342788905e-9],[-20037508342788905e-9,20037508342788905e-9]]],spatialReference:A.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new $({paths:[[[180,-180],[180,180]]],spatialReference:A.WGS84}),minus180Line:new $({paths:[[[-180,-180],[-180,180]]],spatialReference:A.WGS84})}};function S(e,t){return Math.ceil((e-t)/(2*t))}function _(e,t){const s=P(e);for(const o of s)for(const n of o)n[0]+=t;return e}function P(e){return Y(e)?e.rings:e.paths}async function fe(e,t,s,o){const n=typeof e=="string"?E(e):e,i=t[0].spatialReference,u=q(b({},o),{query:q(b({},n.query),{f:"json",sr:JSON.stringify(i),target:JSON.stringify({geometryType:U(t[0]),geometries:t}),cutter:JSON.stringify(s)})}),c=await F(n.path+"/cut",u),{cutIndexes:a,geometries:m=[]}=c.data;return{cutIndexes:a,geometries:m.map(l=>{const x=Z(l);return x.spatialReference=i,x})}}async function ae(e,t,s){const o=typeof e=="string"?E(e):e,n=t[0].spatialReference,i=U(t[0]),u=q(b({},s),{query:q(b({},o.query),{f:"json",sr:n.wkid?n.wkid:JSON.stringify(n),geometries:JSON.stringify(le(t))})});return ue((await F(o.path+"/simplify",u)).data,i,n)}function le(e){return{geometryType:U(e[0]),geometries:e.map(t=>t.toJSON())}}function ue(e,t,s){const o=ee(t);return e.map(n=>{const i=o.fromJSON(n);return i.spatialReference=s,i})}const pe=te.getLogger("esri.geometry.support.normalizeUtils");function he(e){return e.type==="polygon"}function ge(e){return e[0].type==="polygon"}function me(e){return e[0].type==="polyline"}function ye(e,t){if(!(e instanceof $||e instanceof z)){const n="straightLineDensify: the input geometry is neither polyline nor polygon";throw pe.error(n),new ce(n)}const s=P(e),o=[];for(const n of s){const i=[];o.push(i),i.push([n[0][0],n[0][1]]);for(let u=0;u<n.length-1;u++){const c=n[u][0],a=n[u][1],m=n[u+1][0],l=n[u+1][1],x=Math.sqrt((m-c)*(m-c)+(l-a)*(l-a)),y=(l-a)/x,h=(m-c)/x,d=x/t;if(d>1){for(let N=1;N<=d-1;N++){const J=N*t,M=h*J+c,r=y*J+a;i.push([M,r])}const p=(x+Math.floor(d-1)*t)/2,L=h*p+c,v=y*p+a;i.push([L,v])}i.push([m,l])}}return he(e)?new z({rings:o,spatialReference:e.spatialReference}):new $({paths:o,spatialReference:e.spatialReference})}function G(e,t,s){if(t){const o=ye(e,1e6);e=ie(o,!0)}return s&&(e=_(e,s)),e}function T(e,t,s){if(Array.isArray(e)){const o=e[0];if(o>t){const n=S(o,t);e[0]=o+n*(-2*t)}else if(o<s){const n=S(o,s);e[0]=o+n*(-2*s)}}else{const o=e.x;if(o>t){const n=S(o,t);e=e.clone().offset(n*(-2*t),0)}else if(o<s){const n=S(o,s);e=e.clone().offset(n*(-2*s),0)}}return e}function xe(e,t){let s=-1;for(let o=0;o<t.cutIndexes.length;o++){const n=t.cutIndexes[o],i=t.geometries[o],u=P(i);for(let c=0;c<u.length;c++){const a=u[c];a.some(m=>{if(m[0]<180)return!0;{let l=0;for(let y=0;y<a.length;y++){const h=a[y][0];l=h>l?h:l}l=Number(l.toFixed(9));const x=-360*S(l,180);for(let y=0;y<a.length;y++){const h=i.getPoint(c,y);i.setPoint(c,y,h.clone().offset(x,0))}return!0}})}if(n===s){if(ge(e))for(const c of P(i))e[n]=e[n].addRing(c);else if(me(e))for(const c of P(i))e[n]=e[n].addPath(c)}else s=n,e[n]=i}return e}async function de(e,t,s){var o;if(!Array.isArray(e))return de([e],t);const n=(o=t==null?void 0:t.url)!=null?o:ne.geometryServiceUrl;let i,u,c,a,m,l,x,y,h=0;const d=[],p=[];for(const r of e)if(se(r))p.push(r);else if(i||(i=r.spatialReference,u=oe(i),c=i.isWebMercator,l=c?102100:4326,a=I[l].maxX,m=I[l].minX,x=I[l].plus180Line,y=I[l].minus180Line),u)if(r.type==="mesh")p.push(r);else if(r.type==="point")p.push(T(r.clone(),a,m));else if(r.type==="multipoint"){const f=r.clone();f.points=f.points.map(g=>T(g,a,m)),p.push(f)}else if(r.type==="extent"){const f=r.clone()._normalize(!1,!1,u);p.push(f.rings?new z(f):f)}else if(r.extent){const f=r.extent,g=S(f.xmin,m)*(2*a);let R=g===0?r.clone():_(r.clone(),g);f.offset(g,0),f.intersects(x)&&f.xmax!==a?(h=f.xmax>h?f.xmax:h,R=G(R,c),d.push(R),p.push("cut")):f.intersects(y)&&f.xmin!==m?(h=f.xmax*(2*a)>h?f.xmax*(2*a):h,R=G(R,c,360),d.push(R),p.push("cut")):p.push(R)}else p.push(r.clone());else p.push(r);let L=S(h,a),v=-90;const N=L,J=new $;for(;L>0;){const r=360*L-180;J.addPath([[r,v],[r,-1*v]]),v*=-1,L--}if(d.length>0&&N>0){const r=xe(d,await fe(n,d,J,s)),f=[],g=[];for(let w=0;w<p.length;w++){const O=p[w];if(O!=="cut")g.push(O);else{const j=r.shift(),X=e[w];re(X)&&X.type==="polygon"&&X.rings&&X.rings.length>1&&j.rings.length>=X.rings.length?(f.push(j),g.push("simplify")):g.push(c?k(j):j)}}if(!f.length)return g;const R=await ae(n,f,s),W=[];for(let w=0;w<g.length;w++){const O=g[w];O!=="simplify"?W.push(O):W.push(c?k(R.shift()):R.shift())}return W}const M=[];for(let r=0;r<p.length;r++){const f=p[r];if(f!=="cut")M.push(f);else{const g=d.shift();M.push(c===!0?k(g):g)}}return Promise.resolve(M)}export{de as v};
