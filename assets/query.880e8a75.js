var F=Object.defineProperty,b=Object.defineProperties;var j=Object.getOwnPropertyDescriptors;var p=Object.getOwnPropertySymbols;var P=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var S=(n,t,r)=>t in n?F(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,l=(n,t)=>{for(var r in t||(t={}))P.call(t,r)&&S(n,r,t[r]);if(p)for(var r of p(t))q.call(t,r)&&S(n,r,t[r]);return n},m=(n,t)=>b(n,j(t));import{r as o,v as J,C as N,G as z,B as w,b as B}from"./index.6518a001.js";import{v}from"./normalizeUtils.8bc89086.js";import{t as h}from"./pbfQueryUtils.231edae0.js";function E(n){const t={};for(const r in n){if(r==="declaredClass")continue;const e=n[r];if(e!=null&&typeof e!="function")if(Array.isArray(e)){t[r]=[];for(let i=0;i<e.length;i++)t[r][i]=E(e[i])}else typeof e=="object"?e.toJSON&&(t[r]=JSON.stringify(e)):t[r]=e}return t}const x="Layer does not support extent calculation.";function g(n,t){if(t&&n.type==="extent")return`${n.xmin},${n.ymin},${n.xmax},${n.ymax}`;if(t&&n.type==="point")return`${n.x},${n.y}`;const r=n.toJSON();return delete r.spatialReference,JSON.stringify(r)}function O(n,t){const r=n.geometry,e=n.toJSON();delete e.compactGeometryEnabled,delete e.defaultSpatialReferenceEnabled;const i=e,a=n.outSpatialReference;let u,y;if(o(r)&&(u=r.spatialReference,y=r.spatialReference.wkid||JSON.stringify(r.spatialReference),i.geometryType=J(r),i.geometry=g(r,n.compactGeometryEnabled),i.inSR=y),e.groupByFieldsForStatistics&&(i.groupByFieldsForStatistics=e.groupByFieldsForStatistics.join(",")),e.objectIds&&(i.objectIds=e.objectIds.join(",")),e.orderByFields&&(i.orderByFields=e.orderByFields.join(",")),!e.outFields||!e.returnDistinctValues&&(t!=null&&t.returnCountOnly||t!=null&&t.returnExtentOnly||t!=null&&t.returnIdsOnly)?delete i.outFields:e.outFields.indexOf("*")!==-1?i.outFields="*":i.outFields=e.outFields.join(","),e.outSR?i.outSR=e.outSR.wkid||JSON.stringify(e.outSR):r&&(e.returnGeometry||e.returnCentroid)&&(i.outSR=i.inSR),e.returnGeometry&&delete e.returnGeometry,e.outStatistics&&(i.outStatistics=JSON.stringify(e.outStatistics)),e.pixelSize&&(i.pixelSize=JSON.stringify(e.pixelSize)),e.quantizationParameters&&(n.defaultSpatialReferenceEnabled&&o(u)&&o(n.quantizationParameters)&&o(n.quantizationParameters.extent)&&u.equals(n.quantizationParameters.extent.spatialReference)&&delete e.quantizationParameters.extent.spatialReference,i.quantizationParameters=JSON.stringify(e.quantizationParameters)),e.parameterValues&&(i.parameterValues=JSON.stringify(e.parameterValues)),e.rangeValues&&(i.rangeValues=JSON.stringify(e.rangeValues)),e.dynamicDataSource&&(i.layer=JSON.stringify({source:e.dynamicDataSource}),delete e.dynamicDataSource),e.timeExtent){const d=e.timeExtent,{start:s,end:f}=d;s==null&&f==null||(i.time=s===f?s:`${s==null?"null":s},${f==null?"null":f}`),delete e.timeExtent}return n.defaultSpatialReferenceEnabled&&o(u)&&o(a)&&u.equals(a)&&(i.defaultSR=i.inSR,delete i.inSR,delete i.outSR),i}async function I(n,t,r,e){const i=o(t.timeExtent)&&t.timeExtent.isEmpty?{data:{features:[]}}:await c(n,t,"json",e);return w(t,r,i.data),i}async function Q(n,t,r,e){if(o(t.timeExtent)&&t.timeExtent.isEmpty)return Promise.resolve({data:r.createFeatureResult()});const i=await R(n,t,e),a=i;return a.data=h(i.data,r),a}function R(n,t,r){return c(n,t,"pbf",r)}function C(n,t,r){return o(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):c(n,t,"json",r,{returnIdsOnly:!0})}function G(n,t,r){return o(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):c(n,t,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})}function V(n,t,r){return o(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0,extent:null}}):c(n,t,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}).then(e=>{const i=e.data;if(i.hasOwnProperty("extent"))return e;if(i.features)throw new Error(x);if(i.hasOwnProperty("count"))throw new Error(x);return e})}function c(n,t,r,e={},i={}){const a=typeof n=="string"?B(n):n,u=t.geometry?[t.geometry]:[];return e.responseType=r==="pbf"?"array-buffer":"json",v(u,null,e).then(y=>{const d=y&&y[0];o(d)&&((t=t.clone()).geometry=d);const s=E(l(l(m(l({},a.query),{f:r}),i),O(t,i)));return N(z(a.path,"query"),m(l({},e),{query:l(l({},s),e.query)}))})}var A=Object.freeze(Object.defineProperty({__proto__:null,encodeGeometry:g,executeQuery:I,executeQueryForCount:G,executeQueryForExtent:V,executeQueryForIds:C,executeQueryPBF:Q,executeQueryPBFBuffer:R,queryToQueryStringParameters:O,runQuery:c},Symbol.toStringTag,{value:"Module"}));export{G as S,I as c,Q as d,R as f,C as p,A as q,E as t,V as x};
